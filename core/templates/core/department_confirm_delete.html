{% extends 'core/dashboard_base.html' %}
{% load static %}

{% block dashboard_title %}Confirm Delete Department{% endblock %}

{% block page_title %}Confirm Delete Department{% endblock %}

{% block dashboard_content %}

<div class="card">
    {% if related_count > 0 %}
    <div class="alert alert-warning">
        <h4 class="text-warning" style="margin-top: 0;">⚠️ Warning</h4>
        <p>This department is currently assigned to <strong>{{ related_count }}</strong> employees.</p>
        <p>If you delete this department, these employees will be updated to have <strong>No Department</strong>.</p>

        <p><strong>Affected Employees:</strong></p>
        <ul
            style="max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.05); padding: 10px; border-radius: 4px;">
            {% for obj in related_employees %}
            <li>{{ obj }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <p>Are you sure you want to delete department: <strong>{{ department.name }}</strong>?</p>

    <form method="post">
        {% csrf_token %}

        <div style="margin-bottom: 1.5rem;">
            <label for="deleteConfirm" style="display: block; margin-bottom: 0.5rem; color: #4b5563;">Type
                <strong>delete</strong> to confirm:</label>
            <input type="text" id="deleteConfirm" autocomplete="off"
                style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; max-width: 300px;">
        </div>

        <div class="form-actions">
            <button type="submit" id="deleteBtn" class="btn btn-danger" disabled
                style="opacity: 0.5; cursor: not-allowed;">Yes, Delete</button>
            <a href="{% url 'department_list' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
    const input = document.getElementById('deleteConfirm');
    const btn = document.getElementById('deleteBtn');

    input.addEventListener('input', function () {
        if (this.value === 'delete') {
            btn.disabled = false;
            btn.style.opacity = '1';
            btn.style.cursor = 'pointer';
        } else {
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.style.cursor = 'not-allowed';
        }
    });
</script>
{% endblock %}